FROM debian:bullseye-slim

RUN apt-get update && apt-get install -y libpq-dev
RUN apt-get install -y curl
RUN apt-get install libssl-dev -y
RUN apt-get install tree -y
RUN apt-get install -y --no-install-recommends unzip bash
RUN curl -sSL https://raw.githubusercontent.com/maxwellflitton/surrealdb-backup-cli/main/scripts/install.sh | bash

COPY ./db_snapshots/big_data_snapshot/million_rows.sst ./million_rows.sst
RUN ./surrealdb_backup unpack -d ./unpacked_data/  -t ./million_rows.sst
RUN rm ./unpacked_data/LOCK
RUN curl -sSf https://install.surrealdb.com | sh

EXPOSE 8000

CMD ["surreal", "start", "--bind", "0.0.0.0:8000", "--allow-all", "--user", "root", "--pass", "root", "rocksdb:./unpacked_data"]
